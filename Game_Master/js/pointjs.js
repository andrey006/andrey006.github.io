function PointJS(H,Q,R,ma){var Da=!0,Ea=!0,Fa=!1,Ga=!1,I=!1,v=Q,w=R,k={x:0,y:0},p={fillStyle:"black",strokeStyle:"black",globalAlpha:1,font:"sans-serif",textBaseline:"top"},S=function(a){console.log("[PointJS] : ",a)};this.system={log:S};this.system.setSettings=function(a){Da=l(a.isShowError)?a.isShowError:!0;Ea=l(a.isStopForError)?a.isStopForError:!0;Fa=l(a.isAutoClear)?a.isAutoClear:!1;Ga=l(a.isAutoDraw)?a.isAutoDraw:!1};this.system.setDefaultSettings=function(a){for(var b in a)p[b]=a[b]};var e=
function(a,b){return{x:a,y:b}},E=function(a,b){return{w:a,h:b}},M=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},na=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},x=function(a,b,d){if(0!=d){var f=q(d||0);d=a.x-b.x;a=a.y-b.y;var g=Math.cos(f),f=Math.sin(f);return e(d*g-a*f+b.x,d*f+a*g+b.y)}return e(a.x,a.y)},N=function(a,b){if(3>b.length)return!1;for(var d=0,f=b.length-1,e=b[f].y<a.y,g=0;g<b.length;++g){var k=b[g].y<a.y,f=na(b[f],a),h=na(b[g],a),f=f.x*(h.y-f.y)-f.y*(h.x-f.x);k&&!e&&0<f&&(d+=1);!k&&e&&0>f&&
(d+=1);f=g;e=k}return 0!=(d&1)};this.vector={point:e,v2d:e,size:E,w2h:E,getPointAngle:x,isPointIn:N,pointMinus:na,pointPlus:M,pointInc:function(a,b){return{x:a.x*b.x,y:a.y*b.y}},pointDiv:function(a,b){return{x:a.x/(0!=b.x?b.x:1),y:a.y/(0!=b.y?b.y:1)}},pointAbs:function(a){return{x:Math.abs(a.x),y:Math.abs(a.y)}},getMidPoint:function(a,b){return l(b)?e((a.x+b.x)/2,(a.y+b.y)/2):0},getDistance:function(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))},isSame:function(a,b){return l(b)?a.x==
b.x&&a.y==b.y:!1}};var q=function(a){return Math.PI/180*a},T=function(a,b,d){var f=Math.floor(Math.random()*(b-a+1)+a);return d&&0==f?T(a,b,d):f};this.math={limit:function(a,b){var d=Math.sign(a),f=Math.sign(b);a=Math.abs(a||1);b=Math.abs(b||1);return a<b?a*d:b*f},a2r:q,random:T};var h={loaded:!1,events:{onload:{},preLoop:{},postLoop:{},gameBlur:{},gameFocus:{},gameResize:{}},addEvent:function(a,b,d){"onload"==a&&h.loaded?d():h.events[a][b]=d},delEvent:function(a,b){delete h.events[a][b]},runEvent:function(a){for(var b in h.events[a])if("function"==
typeof h.events[a][b])h.events[a][b]()},attach:function(a){var b=function(){window.document.body.appendChild(a)};h.loaded?b():h.addEvent("onload","attachCanvas_PointJS",b)},getWH:function(){return{w:parseInt(window.document.documentElement.clientWidth)<parseInt(screen.width)?parseInt(window.document.documentElement.clientWidth):parseInt(screen.width),h:parseInt(window.document.documentElement.clientHeight)<parseInt(screen.height)?parseInt(window.document.documentElement.clientHeight):parseInt(screen.height)}}};
this.system.delEvent=function(a,b){h.delEvent(a,b)};this.system.addEvent=function(a,b,d){h.addEvent(a,b,d)};this.system.attachDOM=function(a){h.attach(a)};window.document.body.style.overflow="hidden";var m=window.document.createElement("canvas");m.width=parseInt(Q);m.height=parseInt(R);m.style.position="absolute";m.style.left="0";m.style.top="0";m.style.zIndex="1000";m.id="PointJS-canvas";if("object"==typeof ma)for(var Ha in ma)m.style[Ha]=ma[Ha];h.attach(m);var g=m.getContext("2d");this.system.setStyle=
function(a){if("object"==typeof a)for(var b in a)m.style[b]=a[b]};this.system.resize=function(a,b){v=a||Q;w=b||R;m.width=v;m.height=w};this.system.initFullPage=function(){h.addEvent("gameResize","PointJS_resizeGame",function(){v=h.getWH().w;w=h.getWH().h;m.width=v;m.height=w});h.runEvent("gameResize","PointJS_resizeGame")};this.system.exitFullPage=function(){v=Q;w=R;m.width=v;m.height=w};this.system.initFullScale=function(){m.style.width="100%";m.style.height="100%"};this.system.exitFullScale=function(){m.style.width=
Q+"px";m.style.height=R+"px"};this.system.getWH=function(){return h.getWH()};this.keyControl={};var U={LEFT:37,RIGHT:39,UP:38,DOWN:40,SPACE:32,CTRL:17,SHIFT:16,ALT:18,ESC:27,ENTER:13,MINUS:189,PLUS:187,CAPS_LOCK:20,BACKSPACE:8,TAB:9,Q:81,W:87,E:69,R:82,T:84,Y:89,U:85,I:73,O:79,P:80,A:65,S:83,D:68,F:70,G:71,H:72,J:74,K:75,L:76,Z:90,X:88,V:86,B:66,N:78,M:77,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,C:67,9:57,NUM_0:45,NUM_1:35,NUM_2:40,NUM_3:34,NUM_4:37,NUM_5:12,NUM_6:39,NUM_7:36,NUM_8:38,NUM_9:33,
NUM_MINUS:109,NUM_PLUS:107,NUM_LOCK:144,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123};this.keyControl.getKeyList=function(){var a,b=[];for(a in U)b.push(a);return b};var V={},da={},J={},W=!1,oa=!1;this.keyControl.isKeyDown=function(a){return 1==V[U[a]]};this.keyControl.isKeyUp=function(a){return 1==da[U[a]]};this.keyControl.isKeyPress=function(a){var b=!1;1==J[U[a]]&&(b=!0,J[U[a]]=2);return b};this.keyControl.getInputChar=function(){return W};this.keyControl.setInputMode=
function(a){oa=1==a};this.keyControl.exitKeyControl=function(){window.onkeydown=function(){};window.onkeypress=function(){};window.onkeyup=function(){};h.delEvent("postLoop","PointJS_clearAllKeyUp");V={};da={};J={};oa=W=!1};this.keyControl.initKeyControl=function(){window.onkeydown=function(a){if(1==oa)return 8==a.keyCode&&(W="#BS"),!0;a.preventDefault();a.stopPropagation();var b=a.keyCode;2!=J[b]&&(J[b]=1);V[a.keyCode]=!0;return!1};window.onkeypress=function(a){var b=!1;0!=a.which&&0!=a.charCode&&
32<=a.which&&(b=String.fromCharCode(a.which));W=b};window.onkeyup=function(a){a.preventDefault();a.stopPropagation();1==V[a.keyCode]&&(da[a.keyCode]=!0);V[a.keyCode]=!1;a=a.keyCode;2==J[a]&&(J[a]=0);return!1};h.addEvent("postLoop","PointJS_clearAllKeyUp",function(){da={};W=!1})};this.mouseControl={};var F=e(0,0);e(0,0);var X=!0,Y=!1,O=e(0,0),Z={LEFT:1,RIGHT:3,MIDDLE:2},pa={},qa={},aa={},ea=0,fa=function(a){var b=0,d=0;a&&(b=k.x,d=k.y);return e(b+F.x,d+F.y)};this.mouseControl.getMousePosition=function(){return fa()};
this.mouseControl.getMousePositionA=function(){return fa(1)};this.mouseControl.setMouseImage=function(a){window.document.body.style.cursor='url("'+a+'"), auto'};this.mouseControl.setMouseVisible=function(a){!X&&!a||X&&a||(X=1==a,window.document.body.style.cursor=X?"":"none")};this.mouseControl.isCursorVisivle=function(){return X};this.mouseControl.isMouseDown=function(a){return pa[Z[a]]};this.mouseControl.isMouseUp=function(a){return qa[Z[a]]};this.mouseControl.isMousePress=function(a){if(!l(aa[Z[a]])||
2==aa[Z[a]])return!1;aa[Z[a]]=2;return!0};this.mouseControl.isMouseInStatic=function(a){var b=fa(1);return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.mouseControl.isMouseInDynamic=function(a){return N(fa(1),a)};this.mouseControl.isMouseWheel=function(a){return"UP"==a&&0<ea||"DOWN"==a&&0>ea};var Ia=function(a){a.preventDefault();ea=a.wheelDelta?a.wheelDelta:-a.detail;return!1},ga=!1,Ja=function(){ga&&(Y=l(window.document.pointerLockElement)||l(window.document.mozPointerLockElement)?!0:!1)};
this.mouseControl.initMouseLock=function(){h.addEvent("onload","initPointerLock",function(){ga=m.requestPointerLock||m.mozRequestPointerLock||!1;window.document.exitPointerLock=window.document.exitPointerLock||window.document.mozExitPointerLock||!1;"onpointerlockchange"in window.document?window.document.addEventListener("pointerlockchange",Ja,!1):"onmozpointerlockchange"in window.document&&window.document.addEventListener("mozpointerlockchange",Ja,!1);if(!ga)return S("error initMouseLock");Y||(m.onclick=
ga)})};this.mouseControl.exitMouseLock=function(){window.document.exitPointerLock();m.onclick=function(){};O=e(0,0)};this.mouseControl.unlockMouse=function(){O=e(0,0);window.document.exitPointerLock()};this.mouseControl.isMouseLock=function(){return Y};this.mouseControl.getMouseSpeed=function(){return Y?e(O.x,O.y):e(0,0)};this.mouseControl.isPeekStatic=function(a,b){return this.isMousePress(a)?this.isMouseInStatic(b):!1};this.mouseControl.isPeekDynamic=function(a,b){return this.isMousePress(a)?this.isMouseInDynamic(b):
!1};this.mouseControl.initMouseControl=function(){window.onmousemove=function(a){a.preventDefault();a.stopPropagation();if(Y){var b=a.movementX||a.mozMovementX||0;a=a.movementY||a.mozMovementY||0;F.x+=b;F.y+=a;O.x=b;O.y=a}else F.x=a.pageX,F.y=a.pageY;return!1};window.onmousedown=function(a){a.preventDefault();a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));pa[a.which]=!0;aa[a.which]=1!=aa[a.which]?1:!1};window.onmouseup=function(a){a.preventDefault();
a.stopPropagation();!a.which&&a.button&&(a.button&1?a.which=1:a.button&4?a.which=2:a.button&2&&(a.which=3));pa[a.which]=!1;qa[a.which]=!0};window.oncontextmenu=window.onselectstart=window.ondragstart=function(){return!1};window.onmousewheel=Ia;window.addEventListener("DOMMouseScroll",Ia,!1);h.addEvent("postLoop","PointJS_clearAllMouseUp",function(){qa={};ea=0})};this.mouseControl.exitMouseControl=function(){window.onmousemove=window.onmousedown=window.onmouseup=window.oncontextmenu=window.onselectstart=
window.ondragstart=window.onmousewheel=function(){}};this.touchControl={};var ra=!1,sa=1,ta=1,z=0,A=0,n=e(0,0),B=[];this.touchControl.getFixPosition=function(){return n.x||n.y?e(n.x,n.y):!1};this.touchControl.getFixPositionA=function(){return n.x||n.y?e(n.x+k.x,n.y+k.y):!1};this.touchControl.getRun=function(){var a=0,b=0;n.x&&n.x!=z&&(a=z-n.x);n.y&&n.y!=A&&(b=A-n.y);return e(a,b)};this.touchControl.getVector=function(){var a=0,b=0;n.x&&n.x!=z&&(a=z>n.x?1:-1);n.y&&n.y!=A&&(b=A>n.y?1:-1);return e(a,
b)};this.touchControl.isTouchDown=function(){return ra};this.touchControl.isTouchPress=function(){return 0==sa?(sa=1,!0):!1};this.touchControl.isTouchUp=function(){return 0==ta?(ta=1,!0):!1};this.touchControl.getTouchPositionA=function(){return e(z+k.x,A+k.y)};this.touchControl.getTouchPosition=function(){return e(z,A)};this.touchControl.isPeekStatic=function(a){return this.isTouchPress(key)?this.isTouchInStatic(a):!1};this.touchControl.isPeekDynamic=function(a){return this.isTouchPress(key)?this.isTouchInDynamic(a):
!1};this.touchControl.isTouchInStatic=function(a){var b=this.getTouchPositionA();return b.x>=a.x&&b.x<=a.x+a.w&&b.y>=a.y&&b.y<=a.y+a.h};this.touchControl.isTouchInDynamic=function(a){return N(getTouchPositionA(),a)};this.touchControl.getTouches=function(){if(1>B.length)return!1;var a=[],b;for(b=0;b<B.length;b++)a.push({screenX:B[b].pageX,screenY:B[b].pageY,x:B[b].pageX+k.x,y:B[b].pageY+k.y});return a};this.touchControl.initTouchControl=function(){window.addEventListener("touchstart",function(a){a.preventDefault();
a.stopPropagation();z=a.targetTouches[0].pageX;A=a.targetTouches[0].pageY;n.x=z;n.y=A;B=a.targetTouches;ra=!0;sa=0},!0);window.addEventListener("touchmove",function(a){a.preventDefault();a.stopPropagation();z=a.targetTouches[0].pageX;A=a.targetTouches[0].pageY;B=a.targetTouches},!0);window.addEventListener("touchend",function(a){a.preventDefault();a.stopPropagation();B=a.targetTouches;n.x=0;n.y=0;ra=!1;ta=0},!0)};this.touchControl.exitTouchControl=function(){window.ontouchstart=window.ontouchmove=
window.ontouchend=function(a){}};var Va={name:"PointJS",desc:"2D game engine for JavaScript",author:"Skaner -> skaner0@yandex.ru"};this.system.getInfo=function(){return Va};var ha=function(a,b,d,f){return"rgba("+a+", "+b+", "+d+", "+(f?f:1)+")"};this.colors={rgb:function(a,b,d){return ha(a,b,d,1)},rgba:function(a,b,d,f){return ha(a,b,d,f)},h2r:function(a,b){var d=a,d="#"==d[0]?d.substr(1,6):d,f=parseInt(d.substr(0,2),16),e=parseInt(d.substr(2,2),16),d=parseInt(d.substr(4,2),16);return ha(f,e,d,b)},
randomColor:function(a,b,d){return ha(T(a,b),T(a,b),T(a,b),d||1)}};var l=function(a,b){return"undefined"==typeof a||null==a?!1:"undefined"==typeof b?"undefined"!=typeof a||null!=a:"undefined"!=typeof a[b]};this.OOP={toString:function(a,b){var d,f=0,e,g="[";for(d in a)e=a[d],"number"==typeof e&&b&&(e=parseInt(e)),g+=(0<f?", ":"")+d+" : "+e,f++;return g+"]"},isDef:l,unDef:function(a,b){if(!l(a)||!l(b))return"undefined";if(l(a,b))return a[b]="undefined",!0},foreach:function(a,b){for(var d in a)b(a[d],
d,a)}};this.game={};var ua=0,ba={},Ka=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}},ca=Ka(),C={func:function(){console.log('please, use a "setLoop" function.');ca=function(){}},start:!1,end:!1,audio:!1},La=function(){if(C.audio)for(var a in C.audio)C.audio[a].stop()};this.game.createLoop=function(a,b){"function"==typeof b?ba[a]=
{func:b,start:!1,end:!1,audio:!1}:va("error im createLoop")};this.game.setLoopSound=function(a,b){var d;ba[a].audio||(ba[a].audio=[]);for(d=0;d<b.length;d++)b[d].setNextPlay(b[d+1==b.length?0:d+1]),ba[a].audio.push(b[d])};this.game.setLoop=function(a){La();C=ba[a];C.audio&&C.audio[0].play()};var Ma=function(){try{ua=Date.now();if(Fa){var a=e(0,0),b=e(v,w);g.clearRect(a.x,a.y,b.x,b.y)}h.runEvent("preLoop");C.func();if(Ga)for(var d in ia)"function"==typeof ia[d].draw&&ia[d].draw();h.runEvent("postLoop")}catch(f){Da&&
S('ERROR "'+f.toString()+'"'),Ea&&va('error number : 1 - "'+f.toString()+'"')}ca(Ma)},Na=function(a){I||(I=!0,ca(Ma))},va=function(a){I&&(I=!1,La(),ca=function(){S(a||"game is stop")})};this.game.start=Na;this.game.stop=va;this.game.restart=function(a){I||(C.audio&&C.audio[0].play(),S(a||"game is run"),ca=Ka(),Na(60))};var ia=[];H=function(a,b){b.prototype=Object.create(a.prototype);b.prototype.constructor=b};var r=function(a){this.x=a.x||0;this.y=a.y||0;this.w=a.w||5;this.h=a.h||5;this.fillColor=
a.fillColor||!1;this.strokeColor=a.strokeColor||p.strokeStyle;this.strokeWidth=a.strokeWidth||0;this.angle=a.angle||0;this.alpha=l(a.alpha)?a.alpha:1;this.center=e(0,0);this.visible=l(a.visible)?a.visible:!0;this.flip=e(0,0);a.userData&&this.setUserData(a.userData);ia.push(this)};r.prototype={isArrIntersect:function(a){for(var b in a)if(this.isDynamicIntersect(a[b].getDynamicBox()))return!0;return!1},isArrInside:function(a){for(var b in a)if(this.isDynamicInside(a[b].getDynamicBox()))return!0;return!1},
getNearest:function(a){for(var b=1,d=0,f=this.getDistanceC(a[d].getPosition(1)),e;b<a.length;b++)e=this.getDistanceC(a[b].getPosition(1)),e<f&&(f=e,d=b);return a[d]},setFlip:function(a,b){this.flip.x=a||0;this.flip.y=b||0},setUserData:function(a){for(var b in a)l(this,b)||(this[b]=a[b])},getDynamicBox:function(){var a=this.getPosition(1);return 0==this.angle?[e(this.x,this.y),e(this.x+this.w,this.y),e(this.x+this.w,this.y+this.h),e(this.x,this.y+this.h)]:[x(e(this.x,this.y),a,this.getAngle()),x(e(this.x+
this.w,this.y),a,this.getAngle()),x(e(this.x+this.w,this.y+this.h),a,this.getAngle()),x(e(this.x,this.y+this.h),a,this.getAngle())]},isDynamicIntersect:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),d;for(d=0;d<b.length;d++)if(N(b[d],a))return!0;for(d=0;d<a.length;d++)if(N(a[d],b))return!0;return!1},isDynamicInside:function(a){if(3>a.length)return!1;var b=this.getDynamicBox(),d,f=0;for(d=0;d<b.length;d++)N(b[d],a)&&f++;return f==b.length?!0:!1},drawDynamicBox:function(a){y(this.angle,
this.getPosition(1));ja(e(this.x,this.y),e(this.w,this.h),!1,a||"yellow",1);t()},drawStaticBox:function(a){ja(e(this.x,this.y),e(this.w,this.h),!1,a||"white",1)},isStaticIntersect:function(a){return this.y+this.h>=a.y&&this.x+this.w>=a.x&&this.x<a.x+a.w&&this.y<a.y+a.h},getStaticBox:function(){return{x:this.x,y:this.y,w:this.w,h:this.h}},setAlpha:function(a){this.alpha=0<=a?1>=a?a:1:0},getAlpha:function(){return this.alpha},rotate:function(a){this.setAngle(Math.atan2(a.y-this.getPosition(1).y,a.x-
this.getPosition(1).x)*(180/Math.PI))},setCenter:function(a){this.center=e(a.x?Math.abs(a.x)<this.w/2?a.x:0:0,a.y?Math.abs(a.y)<this.h/2?a.y:0:0)},getCenter:function(){return e(this.center.x,this.center.y)},move:function(a){this.x+=a.x||0;this.y+=a.y||0},circling:function(a,b,d){l(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.x=a.x+b*Math.cos(q(this.circlingAnglePointJS));this.y=a.y+b*Math.sin(q(this.circlingAnglePointJS));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:
this.circlingAnglePointJS+d},circlingC:function(a,b,d){l(this.circlingAnglePointJS)||(this.circlingAnglePointJS=0);this.setPositionC(e(a.x+b*Math.cos(q(this.circlingAnglePointJS)),a.y+b*Math.sin(q(this.circlingAnglePointJS))));this.circlingAnglePointJS=360<this.circlingAnglePointJS?0:this.circlingAnglePointJS+d},motion:function(a,b,d){l(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.x=a.x+b.w*Math.cos(q(this.motionPercentPointJS));this.y=a.y+b.h*Math.sin(q(this.motionPercentPointJS));
this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+d},motionC:function(a,b,d){l(this.motionPercentPointJS)||(this.motionPercentPointJS=0);this.setPositionC(e(a.x+b.w*Math.cos(q(this.motionPercentPointJS)),a.y+b.h*Math.sin(q(this.motionPercentPointJS))));this.motionPercentPointJS=360<this.motionPercentPointJS?0:this.motionPercentPointJS+d},scale:function(a){this.w+=a.w||0;this.h+=a.h||0},scaleC:function(a){this.scale(a);this.move(e(-(a.w/2),-(a.h/2)))},getPosition:function(a){return 1==
a?e(this.x+(this.w/2+this.center.x),this.y+(this.h/2+this.center.y)):2==a?(a=e(this.x+this.w/2,this.y+this.h/2),this.angle&&(a=x(a,this.getPosition(1),this.angle)),e(a.x,a.y)):e(this.x,this.y)},setPosition:function(a){this.x=a.x?a.x:this.x;this.y=a.y?a.y:this.y},setPositionC:function(a){var b=this.w/2+this.center.x,d=this.h/2+this.center.y;this.x=a.x?-b+a.x:this.x;this.y=a.y?-d+a.y:this.y},getSize:function(){return E(this.w,this.h)},setSize:function(a){this.w=a.w?a.w:this.w;this.h=a.h?a.h:this.h},
setSizeC:function(a){this.w=a.w?a.w:this.w;this.h=a.h?a.h:this.h;this.move(e(-(a.w/2),-(a.h/2)))},turn:function(a){this.angle%=360;this.angle+=a},moveAngle:function(a){this.x+=a*Math.cos(q(this.angle));this.y+=a*Math.sin(q(this.angle))},moveTime:function(a,b){b=b||1;var d=this.getPosition();this.move(e((a.x-d.x)/b,(a.y-d.y)/b))},moveTimeC:function(a,b){b=b||1;var d=this.getPosition(1);this.move(e((a.x-d.x)/b,(a.y-d.y)/b))},getAngle:function(){return this.angle},setAngle:function(a){this.angle=a%360},
getDistance:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(2).x,2)+Math.pow(a.y-this.getPosition(2).y,2))},getDistanceC:function(a){return Math.sqrt(Math.pow(a.x-this.getPosition(1).x,2)+Math.pow(a.y-this.getPosition(1).y,2))},setVisible:function(a){this.visible=1==a},isVisible:function(){return this.visible},isInCamera:function(){var a=this.getPosition(2);return a.x<k.x||a.x>k.x+v||a.y<k.y||a.y>k.y+w?!1:!0},draw:function(){}};this.game.newBaseObject=function(a){return new r(a)};var wa=
function(a){r.call(this,a)};H(r,wa);wa.prototype.draw=function(){if(this.visible){var a=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),this.alpha),a=!0;ja(e(this.x,this.y),e(this.w,this.h),this.fillColor,this.strokeColor,this.strokeWidth);a&&t()}};this.game.newRectObject=function(a){return new wa(a)};var K=function(a){r.call(this,a);this.radius=a.radius||5;this.w=2*this.radius;this.h=2*this.radius};H(r,K);K.prototype.draw=function(){if(this.visible){var a=!1;if(this.angle||1!=this.alpha)y(this.angle,
this.getPosition(1),this.alpha),a=!0;xa(e(this.x,this.y),this.radius,this.fillColor,this.strokeColor,this.strokeWidth);a&&t()}};K.prototype.scale=function(a){this.w+=a||0;this.h+=a||0;this.radius+=a/2||0;1==c&&this.move(e(-(a/2),-(a/2)))};K.prototype.scaleC=function(a){this.w+=a||0;this.h+=a||0;this.radius+=a/2||0;this.move(e(-(a/2),-(a/2)))};K.prototype.getRadius=function(){return this.radius};K.prototype.setRadius=function(a){this.radius=a||5;this.w=2*a;this.h=2*a};this.game.newCircleObject=function(a){return new K(a)};
var ya=function(a){r.call(this,a)};H(r,ya);ya.prototype.draw=function(){if(this.visible){var a=this.w/2,b=this.h/2,d=this.getPosition(2);g.save();g.translate(d.x,d.y);this.angle&&g.rotate(q(this.angle));1!=this.alpha&&(g.globalAlpha=this.alpha);g.scale(a/b,1);g.translate(-d.x,-d.y);xa(e(this.x+b,this.y),b,this.fillColor,this.strokeColor,this.strokeWidth);t()}};this.game.newEllipsObject=function(a){return new ya(a)};var u=function(a){r.call(this,a);this.points=[];this.dX=this.dY=0;var b;if(a.points)for(b in a.points)this.addPoint(a.points[b]);
this.pointColor=a.pointColor||!1};H(r,u);u.prototype.addPoint=function(a){this.dY=this.dX=0;var b;if(this.y+a.y<this.y)for(b in this.dY=Math.abs(this.y+a.y-this.y),this.points)this.points[b].y+=this.dY;if(this.x+a.x<this.x)for(b in this.dX=Math.abs(this.x+a.x-this.x),this.points)this.points[b].x+=this.dX;this.points.push(e(a.x+this.dX,a.y+this.dY));this.h=this.w=0;for(b in this.points)this.h+=this.y+this.points[b].y>this.y+this.h?this.points[b].y-this.h:0,this.w+=this.x+this.points[b].x>this.x+this.w?
this.points[b].x-this.w:0};u.prototype.delPoint=function(a){var b,d=this.getPoints();this.clearPoints();for(b=0;b<d.length;b++)b!=a&&this.addPoint(d[b])};u.prototype.clearPoints=function(){this.points=[];this.count=0};u.prototype.getPoints=function(){return this.points};u.prototype.getCount=function(){return this.points.length};u.prototype.getPoint=function(a){return this.points[a]};u.prototype.scale=function(a){};u.prototype.drawDynamicBox=function(a){var b=!1;if(this.angle||1!=this.alpha)y(this.angle,
this.getPosition(1),this.alpha),b=!0;Oa(this.x,this.y,this.points,this.fillColor,a||"yellow",2,"red");b&&t()};u.prototype.getDynamicBox=function(){var a=[],b;if(this.angle){var d=this.getPosition(1);for(b in this.points)a.push(x(M(this.points[b],e(this.x,this.y)),d,this.getAngle()))}else for(b in this.points)a.push(M(this.points[b],e(this.x,this.y)));return a};u.prototype.draw=function(){if(this.visible){var a=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),this.alpha),a=!0;Oa(this.x,
this.y,this.points,this.fillColor,this.strokeColor,this.strokeWidth,this.pointColor);a&&t()}};this.game.newPolygonObject=function(a){return new u(a)};var P=function(a){r.call(this,a);this.w=a.w?a.w:0;this.h=a.h?a.h:0;this.loaded=!1;this.file="";Pa(a.file,this,a.scale||1)};H(r,P);P.prototype.draw=function(){if(this.visible&&this.loaded){var a=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),this.alpha),a=!0;Qa(e(this.x,this.y),E(this.w,this.h),this.file);a&&t()}};P.prototype.simpleDraw=
function(a){if(this.loaded){var b=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),this.alpha),b=!0;Qa(e(a.x,a.y),E(this.w,this.h),this.file);b&&t()}};P.prototype.setImage=function(a,b){this.file!=a&&(l(D,a)?this.file=a:(this.loaded=!1,this.origHeight=this.origWidth=0,Pa(a,this)))};P.prototype.getImage=function(){return this.file};this.game.newImageObject=function(a){return new P(a)};var L=function(a){r.call(this,a);this.frame=0;this.anim=a.animation;this.step=a.delay||10;this.difStep=
0};H(r,L);L.prototype.draw=function(){if(this.visible){var a=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),this.alpha),a=!0;if(this.flip.x||this.flip.y)za(this.getPosition(1),this.flip),a=!0;Aa(this.anim,e(this.x,this.y),E(this.w,this.h),this.frame);this.difStep>this.step?(this.frame=this.frame<this.anim.r?this.frame+1:0,this.difStep=0):this.difStep++;a&&t()}};L.prototype.drawFrames=function(a,b,d){if(this.visible){d=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),
this.alpha),d=!0;if(this.flip.x||this.flip.y)za(this.getPosition(1),this.flip),d=!0;Aa(this.anim,e(this.x,this.y),E(this.w,this.h),this.frame);this.difStep>this.step?(this.frame=this.frame<b-1?this.frame+1:a-1,this.difStep=0):this.difStep++;d&&t()}};L.prototype.drawFrame=function(a){if(this.visible){var b=!1;if(this.angle||1!=this.alpha)y(this.angle,this.getPosition(1),this.alpha),b=!0;if(this.flip.x||this.flip.y)za(this.getPosition(1),this.flip),b=!0;Aa(this.anim,e(this.x,this.y),E(this.w,this.h),
a-1);b&&t()}};L.prototype.setAnimation=function(a){this.anim=a};L.prototype.getAnimation=function(){return this.anim};this.game.newAnimationObject=function(a){return new L(a)};this.tiles={};var Ba=function(a){this.file=a;this.loaded=!1;this.h=this.w=0;var b=window.document.createElement("img"),d=this;b.onload=function(){d.loaded=!0;d.w=this.width;d.h=this.height;d.img=this};b.src=a};Ba.prototype.getTile=function(a,b,d,f){return{image:this,x:a,y:b,w:d,h:f}};Ba.prototype.getAnimation=function(a,b,d,
f,e){return{image:this,x:a,y:b,w:d,h:f,r:e?e-1:0}};this.tiles.newImage=function(a){return new Ba(a)};var Aa=function(a,b,d,f){a.image.loaded&&g.drawImage(a.image.img,a.x+a.w*f,a.y,a.w,a.h,b.x+-k.x,b.y+-k.y,d.w,d.h)},D={},Pa=function(a,b,d){if(!l(D,a)){var f=window.document.createElement("img");f.onload=function(){D[a]={};D[a].img=this;D[a].w=this.width;D[a].h=this.height;l(b)&&(b.loaded=!0,b.w||(b.w=this.width*(d?d:1)),b.h||(b.h=this.height*(d?d:1)),b.file=a)};f.src=a}},Qa=function(a,b,d){d&&g.drawImage(D[d].img,
0,0,D[d].w,D[d].h,a.x+-k.x,a.y+-k.y,b.w,b.h)},Ra=function(a){this.objs=[];this.x=a.x||0;this.y=a.y||0;this.angle=a.angle||0;this.count=0;if(a.add)for(var b in a.add)this.add(a.add[b]);this.angle&&this.setAngle(this.angle)};Ra.prototype={getCount:function(){return this.count},add:function(a){this.count++;this.objs.push(a);a.offsetMesh=a.getPosition(1);a.setPositionC(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},del:function(a){for(var b in this.objs)this.objs[b]==a&&(this.objs.splice(b,1),this.count--)},
move:function(a){this.x+=a.x||0;this.y+=a.y||0;for(var b in this.objs)a=this.objs[b],a.setPositionC(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))},turn:function(a){if(0!=a){this.angle%=360;this.angle+=a;var b,d,f=e(this.x,this.y);for(b in this.objs)d=this.objs[b],d.turn(a),d.setPositionC(x(e(this.x+d.offsetMesh.x,this.y+d.offsetMesh.y),f,this.angle))}},setAngle:function(a){if(a!=this.angle){this.angle=a%=360;var b,d,f=e(this.x,this.y);for(b in this.objs)d=this.objs[b],d.setAngle(a),d.setPositionC(x(e(this.x+
d.offsetMesh.x,this.y+d.offsetMesh.y),f,this.angle))}},setPosition:function(a){if(this.x!=a.x||this.y!=a.y){this.x=a.x||this.x;this.y=a.y||this.y;for(var b in this.objs)a=this.objs[b],this.angle?a.setPositionC(x(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y),e(this.x,this.y),this.angle)):a.setPositionC(e(this.x+a.offsetMesh.x,this.y+a.offsetMesh.y))}},isDynamicIntersect:function(a){if(3>a.length)return!1;var b,d;for(b in this.objs)if(d=this.objs[b],d.isDynamicIntersect(a))return d;return!1},isStaticIntersect:function(a){var b,
d;for(b in this.objs)if(d=this.objs[b],d.isStaticIntersect(a))return d;return!1}};this.game.newMesh=function(a){return new Ra(a)};this.brush={};this.game.moveCamera=function(a){k.x+=a.x||0;k.y+=a.y||0};this.game.setCameraPosition=function(a){a=e(a.x?a.x-v/2:0,a.y?a.y-w/2:0);k=e(a.x||k.x,a.y||k.y)};this.game.turnCamera=function(a,b){e(a.x,a.y)};this.game.setCameraAngle=function(a,b){e(a.x,a.y)};var t=function(){g.restore();g.globalAlpha=p.globalAlpha},za=function(a,b){g.save();g.translate(-k.x+a.x,
-k.y+a.y);g.scale(b.x?-1:1,b.y?-1:1);g.translate(-a.x+k.x,-a.y+k.y)},y=function(a,b,d,f){g.save();a&&b&&(g.translate(-k.x+b.x,-k.y+b.y),g.rotate(q(a)),g.translate(-b.x+k.x,-b.y+k.y));1!=d&&(g.globalAlpha=d);f&&f.flipX&&g.scale(-1,-1)};this.system.setContextSettings=function(a){g.save();for(var b in a)g[b]=a[b]};this.system.defaultSettings=function(){t()};this.game.clearContext=function(){var a=e(0,0),b=e(v,w);g.clearRect(a.x,a.y,b.x,b.y)};this.game.fillContext=function(a){g.fillStyle=a||"white";g.fillRect(0,
0,v,w)};var Oa=function(a,b,d,f,h,m,n){if(!(3>d.length)){var l;if(f&&!(3>d.length)){g.fillStyle=f;f=-k.x+a;l=-k.y+b;var p;g.beginPath();g.moveTo(f+d[0].x,l+d[0].y);for(p=1;p<d.length;p++)g.lineTo(f+d[p].x,l+d[p].y);g.closePath();g.fill()}for(f=0;f<d.length;f++)l=f+1<d.length?f+1:0,h&&ka(M(d[f],e(a,b)),M(d[l],e(a,b)),h,m),n&&Ca(M(d[f],e(a,b)),n)}};this.brush.drawPolygon=function(a){var b=a.points||[],d=a.fillColor||!1,f=a.strokeColor||!1,e=a.strokeWidth||1;a=a.pointColor||!1;if(!(3>b.length)){var h;
if(d&&!(3>b.length)){g.fillStyle=d;d=-k.x;h=-k.y;var l;g.beginPath();g.moveTo(d+b[0].x,h+b[0].y);for(l=1;l<b.length;l++)g.lineTo(d+b[l].x,h+b[l].y);g.closePath();g.fill()}for(d=0;d<b.length;d++)h=d+1<b.length?d+1:0,f&&ka(b[d],b[h],f,e),a&&Ca(b[d],a)}};var Sa=function(a,b,d,f,e,h){g.fillStyle=d;g.font=(h?h+" ":"")+f+"px "+e;g.fillText(b,-k.x+a.x,-k.y+a.y)};this.brush.drawText=function(a){Sa(e(a.x,a.y),a.text,a.color||p.fillStyle,a.size||10,a.font||p.font,a.style||!1)};this.brush.drawTextLines=function(a){if(a.lines){var b;
for(b=0;b<a.lines.length;b++)Sa(e(a.x,a.y+a.size*b),a.lines[b],a.color||p.fillStyle,a.size||10,a.font||p.font,a.style||!1)}};var ja=function(a,b,d,f,e){g.fillStyle=d;g.strokeStyle=f;g.lineWidth=e;f=-k.x+(e?e/2:0);var h=-k.y+(e?e/2:0);d&&g.fillRect(a.x+f,a.y+h,b.x,b.y);e&&g.strokeRect(a.x+f,a.y+h,b.x,b.y)};this.brush.drawRect=function(a){ja(e(a.x,a.y),e(a.w,a.h),a.fillColor||!1,a.strokeColor||p.strokeStyle,a.strokeWidth||!1)};var Ca=function(a,b){(g.fillStyle=b)&&g.fillRect(-k.x+a.x-1,-k.y+a.y-1,2,
2)};this.brush.drawPoint=function(a){Ca(e(a.x,a.y),a.fillColor||!1)};var xa=function(a,b,d,f,e){g.fillStyle=d;g.strokeStyle=f;g.lineWidth=e;f=-k.x+b+(e?e/2:0);var h=-k.y+b+(e?e/2:0);g.beginPath();g.arc(a.x+f,a.y+h,b,0,2*Math.PI,!0);g.closePath();d&&g.fill();e&&g.stroke()};this.brush.drawCircle=function(a){xa(e(a.x,a.y),a.radius,a.fillColor||!1,a.strokeColor||p.strokeStyle,a.strokeWidth||!1)};var ka=function(a,b,d,f){g.strokeStyle=d;g.lineWidth=f;d=-k.x+(f?f/2:0);f=-k.y+(f?f/2:0);g.beginPath();g.moveTo(d+
a.x,f+a.y);g.lineTo(d+b.x,f+b.y);g.closePath();g.stroke()};this.brush.drawLine=function(a){ka(e(a.x1,a.y1),e(a.x1+a.x2,a.y1+a.y2),a.strokeColor||p.strokeStyle,a.strokeWidth||1)};this.brush.drawLineA=function(a){ka(e(a.x1,a.y1),e(a.x2,a.y2),a.strokeColor||p.strokeStyle,a.strokeWidth||1)};this.brush.getPixelColor=function(a,b){var d=g.getImageData(a,b,1,1).data;return"rgb("+d[0]+", "+d[1]+", "+d[2]+")"};this.brush.setPixelColor=function(a,b,d){var f=g.createImageData(1,1);f.data[0]=d.r||f.data[0];f.data[1]=
d.g||f.data[1];f.data[2]=d.b||f.data[2];f.data[3]=d.a||255;g.putImageData(f,a,b)};this.brush.onPixel=function(a,b,d){var f=g.getImageData(a,b,1,1),e={r:f.data[0],g:f.data[1],b:f.data[2],a:f.data[3]?f.data[3]:255};d(e);f.data[0]=e.r;f.data[1]=e.g;f.data[2]=e.b;f.data[3]=e.a;g.putImageData(f,a,b)};this.brush.onPixels=function(a,b,d,e,h){d=g.getImageData(a,b,d,e);var k;e=0;for(k=d.data.length;e<k;e+=4){var l={r:d.data[e],g:d.data[e+1],b:d.data[e+2],a:d.data[e+3]?d.data[e+3]:255};h(l);d.data[e]=l.r;d.data[e+
1]=l.g;d.data[e+2]=l.b;d.data[e+3]=l.a}g.putImageData(d,a,b)};this.brush.onRawPixels=function(a,b,d,e,h){d=g.getImageData(a,b,d,e);h(d.data,d.data.length);g.putImageData(d,a,b)};this.audio={};var G=function(a,b){var d,e,g=window.document.createElement("audio");if("string"==typeof a){var h=window.document.createElement("source");h.src=a;g.appendChild(h)}else for(d=0,e=a.length;d<e;d++)h=window.document.createElement("source"),h.src=a[d],g.appendChild(h);this.vol=b&&1>=b&&0<b?b:1;this.playing=0;this.audio=
g;this.nextPlay=this.loaded=!1;this.audio.volume=this.vol;var k=this;this.audio.onloadeddata=function(){k.loaded=!0};this.audio.onended=function(){k.playing=!1;k.nextPlay&&k.nextPlay.play()};this.audio.load()};G.prototype.play=function(a){this.loaded&&!this.playing&&(a&&(this.vol=a&&1>=a&&0<a?a:this.vol,this.audio.volume=this.vol),this.playing=!0,this.audio.play())};G.prototype.replay=function(a){this.loaded&&(a&&(this.vol=a&&1>=a&&0<a?a:this.vol,this.audio.volume=this.vol),this.playing=!0,this.audio.currentTime=
0,this.audio.play())};G.prototype.stop=function(){this.loaded&&this.playing&&(this.playing=!1,this.audio.pause(),this.audio.currentTime=0)};G.prototype.pause=function(){this.loaded&&this.playing&&(this.playing=!1,this.audio.pause())};G.prototype.setNextPlay=function(a){this.nextPlay=a};G.prototype.setVolume=function(a){this.vol=a&&1>=a&&0<a?a:this.vol;this.audio.volume=this.vol};G.prototype.getVolume=function(){return this.vol};this.audio.newAudio=function(a,b){return new G(a,b)};var Ta=0,Ua=0,la=
0;this.system.initFPSCheck=function(){h.addEvent("postLoop","fpsCheckUpdate",function(){la+=1;1E3<=ua-Ua&&(Ta=la,la=0,Ua=ua)})};this.system.getFPS=function(){return Ta};window.onload=function(){for(var a in h.events.onload)if("function"==typeof h.events.onload[a])h.events.onload[a]();h.loaded=!0;for(a in p)g[a]=p[a];return!1};window.onblur=function(){if(I)return h.runEvent("gameBlur"),!1};window.onfocus=function(){if(!I)return h.runEvent("gameFocus"),!1};window.onresize=function(){h.runEvent("gameResize");
g.textBaseline=p.textBaseline;return!1}};